<!DOCTYPE html>
<html>
<head>
    <title>Jastip Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>üì¶ JASTIP TEST</h1>
    
    <textarea id="data" rows="4" cols="50" style="width:100%;">81365245060 danny5060 tas 1 159000 dapat 50000</textarea>
    <br><br>
    <button onclick="testImport()" style="padding:10px 20px;">TEST IMPORT</button>
    <button onclick="testLoad()" style="padding:10px 20px;">TEST LOAD</button>
    
    <div id="log" style="margin-top:20px; background:#f0f0f0; padding:10px;"></div>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += '<div>' + msg + '</div>';
            console.log(msg);
        }

        const supabase = window.supabase.createClient(
            'https://ntyetosvnafeuhnmljd.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im50eWV0b3N2bmFmZXVsaG5tamxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MDI1MTgsImV4cCI6MjA4NzA3ODUxOH0.GwsN9AR9rHS8CNDZuC80_gN52lSl_IUa2qixuUGFynU'
        );
        log('‚úÖ Supabase initialized');

        async function testImport() {
            log('üü¢ Tombol IMPORT diklik');
            
            const text = document.getElementById('data').value;
            log('üìù Data: ' + text);
            
            const parts = text.trim().split(/\s+/);
            log('üîç Parts: ' + JSON.stringify(parts));
            
            if (parts.length < 6) {
                log('‚ùå Format salah!');
                return;
            }
            
            const [noHp, nama, produk, qty, harga, status, dp=0] = parts;
            log('üìä Parsed: ' + JSON.stringify({noHp, nama, produk, qty, harga, status, dp}));
            
            log('‚è≥ Mencoba insert ke Supabase...');
            const { data, error } = await supabase.from('customers').insert([{
                phone: noHp,
                name: nama,
                products: [{
                    nama: produk,
                    qty: parseInt(qty),
                    harga: parseInt(harga),
                    status: status,
                    dp: parseInt(dp)
                }],
                total_dp: parseInt(dp),
                last_update: new Date().toLocaleString('id-ID')
            }]);
            
            if (error) {
                log('‚ùå ERROR: ' + JSON.stringify(error));
            } else {
                log('‚úÖ SUKSES! Data masuk');
            }
        }

        async function testLoad() {
            log('üü¢ Tombol LOAD diklik');
            const { data, error } = await supabase.from('customers').select('*');
            
            if (error) {
                log('‚ùå ERROR: ' + JSON.stringify(error));
            } else {
                log('üì¶ Data: ' + JSON.stringify(data, null, 2));
            }
        }
    </script>
</body>
</html>
