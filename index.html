<!DOCTYPE html>
<html>
<head>
    <title>Jastip Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>ðŸ“¦ JASTIP ADMIN</h1>
    <p>Status: <span id="status">Loading...</span></p>
    
    <textarea id="data" rows="5" cols="50" placeholder="Masukkan data...">81365245060 danny5060 tas 1 159000 dapat 50000</textarea>
    <br>
    <button onclick="importData()">IMPORT</button>
    <button onclick="loadData()">REFRESH</button>
    
    <h2>Data Customer:</h2>
    <div id="result"></div>

    <script>
        // CONFIG SUPABASE
        const SUPABASE_URL = 'https://ntyetosvnafeuhnmljd.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im50eWV0b3N2bmFmZXVsaG5tamxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MDI1MTgsImV4cCI6MjA4NzA3ODUxOH0.GwsN9AR9rHS8CNDZuC80_gN52lSl_IUa2qixuUGFynU';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        document.getElementById('status').innerText = 'Connected!';

        async function importData() {
            const text = document.getElementById('data').value;
            const parts = text.trim().split(/\s+/);
            
            if (parts.length < 6) {
                alert('Format salah! Minimal 6 kolom');
                return;
            }

            const [noHp, nama, produk, qty, harga, status, dp = 0] = parts;

            const { error } = await supabase
                .from('customers')
                .insert([{
                    phone: noHp,
                    name: nama,
                    products: [{
                        nama: produk,
                        qty: parseInt(qty),
                        harga: parseInt(harga),
                        status: status,
                        dp: parseInt(dp)
                    }],
                    total_dp: parseInt(dp),
                    last_update: new Date().toLocaleString('id-ID'),
                    first_order: new Date().toISOString()
                }]);

            if (error) {
                alert('Error: ' + error.message);
            } else {
                alert('Data berhasil diimport!');
                loadData();
            }
        }

        async function loadData() {
            const { data: customers, error } = await supabase
                .from('customers')
                .select('*');
                
            if (error) {
                document.getElementById('result').innerHTML = 'Error: ' + error.message;
            } else {
                document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(customers, null, 2) + '</pre>';
            }
        }

        loadData();
    </script>
</body>
</html>
