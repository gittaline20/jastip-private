<!DOCTYPE html>
<html>
<head>
    <title>Jastip Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>ðŸ“¦ JASTIP ADMIN</h1>
    
    <textarea id="data" rows="4" style="width:100%;">81365245060 danny5060 tas 1 159000 dapat 50000</textarea>
    <br><br>
    <button onclick="importData()" style="padding:10px 20px;">IMPORT</button>
    <button onclick="loadData()" style="padding:10px 20px;">REFRESH</button>
    <div id="error" style="color:red; margin:10px 0;"></div>
    
    <h2>Data Customer:</h2>
    <div id="result"></div>

    <script>
        const SUPABASE_URL = 'https://ntyetosvnafeuhnmljd.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im50eWV0b3N2bmFmZXVsaG5tamxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MDI1MTgsImV4cCI6MjA4NzA3ODUxOH0.GwsN9AR9rHS8CNDZuC80_gN52lSl_IUa2qixuUGFynU';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function importData() {
            const text = document.getElementById('data').value;
            const parts = text.trim().split(/\s+/);
            
            if (parts.length < 6) {
                document.getElementById('error').innerText = 'Format salah! Minimal 6 kolom';
                return;
            }
            
            const [noHp, nama, produk, qty, harga, status, dp=0] = parts;
            
            const { data, error } = await supabase.from('customers').insert([{
                phone: noHp,
                name: nama,
                products: [{
                    nama: produk,
                    qty: parseInt(qty),
                    harga: parseInt(harga),
                    status: status,
                    dp: parseInt(dp)
                }],
                total_dp: parseInt(dp),
                last_update: new Date().toLocaleString('id-ID')
            }]);
            
            if (error) {
                document.getElementById('error').innerHTML = 'ERROR: ' + error.message;
            } else {
                document.getElementById('error').innerHTML = 'âœ… SUKSES!';
                document.getElementById('data').value = '';
                loadData();
            }
        }

        async function loadData() {
            const { data, error } = await supabase.from('customers').select('*');
            
            if (error) {
                document.getElementById('result').innerHTML = 'Error: ' + error.message;
                return;
            }
            
            if (!data || data.length === 0) {
                document.getElementById('result').innerHTML = 'Belum ada data';
                return;
            }
            
            let html = '';
            data.forEach(c => {
                const token = btoa(c.phone + 'jastip2024').substring(0,15);
                const link = window.location.origin + '/customer.html?id=' + c.phone + '&token=' + token;
                
                html += `
                    <div style="border:1px solid #ccc; padding:10px; margin:10px 0;">
                        <div><strong>${c.name}</strong> - ${c.phone}</div>
                        <div style="background:#f0f0f0; padding:5px; font-family:monospace;">${link}</div>
                        <button onclick="copyLink('${c.phone}')" style="margin-top:5px;">COPY LINK</button>
                    </div>
                `;
            });
            document.getElementById('result').innerHTML = html;
        }

        function copyLink(phone) {
            const token = btoa(phone + 'jastip2024').substring(0,15);
            const link = window.location.origin + '/customer.html?id=' + phone + '&token=' + token;
            navigator.clipboard.writeText(link).then(() => alert('Link disalin!'));
        }

        loadData();
    </script>
</body>
</html>
